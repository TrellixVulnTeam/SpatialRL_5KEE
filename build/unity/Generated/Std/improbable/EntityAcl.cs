// Generated by SpatialOS codegen. DO NOT EDIT!
// source: EntityAcl in improbable/standard_library.schema.

namespace Improbable
{

public static class EntityAcl_Extensions
{
  public static EntityAcl.Data Get(this global::Improbable.Worker.IComponentData<EntityAcl> data)
  {
    return (EntityAcl.Data) data;
  }

  public static EntityAcl.Update Get(this global::Improbable.Worker.IComponentUpdate<EntityAcl> update)
  {
    return (EntityAcl.Update) update;
  }
}

public partial class EntityAcl : global::Improbable.Worker.IComponentMetaclass
{
  public static uint ComponentId = 50;

  uint global::Improbable.Worker.IComponentMetaclass.ComponentId
  {
    get { return ComponentId; }
  }

  /// <summary>
  /// Concrete data type for the EntityAcl component.
  /// </summary>
  public class Data : global::Improbable.Worker.IComponentData<EntityAcl>
  {
    public global::Improbable.EntityAclData Value;

    public Data(global::Improbable.EntityAclData value)
    {
      Value = value;
    }

    public Data(
        global::Improbable.Collections.Option<global::Improbable.WorkerPredicate> read,
        global::Improbable.Collections.Option<global::Improbable.ComponentAcl> componentAcl)
    {
      Value = new global::Improbable.EntityAclData(
          read,
          componentAcl);
    }

    public Data DeepCopy()
    {
      return new Data(Value.DeepCopy());
    }

    public global::Improbable.Worker.IComponentUpdate<EntityAcl> ToUpdate()
    {
      var update = new Update();
      update.SetRead(Value.read);
      update.SetComponentAcl(Value.componentAcl);
      return update;
    }
  }

  /// <summary>
  /// Concrete update type for the EntityAcl component.
  /// </summary>
  public class Update : global::Improbable.Worker.IComponentUpdate<EntityAcl>
  {
    /// <summary>
    /// Field read = 1.
    /// </summary>
    public global::Improbable.Collections.Option<global::Improbable.Collections.Option<global::Improbable.WorkerPredicate>> read;
    public Update SetRead(global::Improbable.Collections.Option<global::Improbable.WorkerPredicate> _value)
    {
      read.Set(_value);
      return this;
    }

    /// <summary>
    /// Field component_acl = 2.
    /// </summary>
    public global::Improbable.Collections.Option<global::Improbable.Collections.Option<global::Improbable.ComponentAcl>> componentAcl;
    public Update SetComponentAcl(global::Improbable.Collections.Option<global::Improbable.ComponentAcl> _value)
    {
      componentAcl.Set(_value);
      return this;
    }

    public Update DeepCopy()
    {
      var _result = new Update();
      if (read.HasValue)
      {
        global::Improbable.Collections.Option<global::Improbable.WorkerPredicate> field;
        field = new global::Improbable.Collections.Option<global::Improbable.WorkerPredicate>();
        if (read.Value.HasValue)
        {
          field.Set(read.Value.Value.DeepCopy());
        }
        _result.read.Set(field);
      }
      if (componentAcl.HasValue)
      {
        global::Improbable.Collections.Option<global::Improbable.ComponentAcl> field;
        field = new global::Improbable.Collections.Option<global::Improbable.ComponentAcl>();
        if (componentAcl.Value.HasValue)
        {
          field.Set(componentAcl.Value.Value.DeepCopy());
        }
        _result.componentAcl.Set(field);
      }
      return _result;
    }

    public global::Improbable.Worker.IComponentData<EntityAcl> ToInitialData()
    {
      return new Data(new global::Improbable.EntityAclData(
          read.Value,
          componentAcl.Value));
    }

    public void ApplyTo(global::Improbable.Worker.IComponentData<EntityAcl> _data)
    {
      var _concrete = _data.Get();
      if (read.HasValue)
      {
        _concrete.Value.read = read.Value;
      }
      if (componentAcl.HasValue)
      {
        _concrete.Value.componentAcl = componentAcl.Value;
      }
    }
  }

  public partial class Commands
  {
  }

  // Implementation details below here.
  //----------------------------------------------------------------

  public global::Improbable.Worker.Internal.ComponentProtocol.ClientComponentVtable Vtable {
    get {
      global::Improbable.Worker.Internal.ComponentProtocol.ClientComponentVtable vtable;
      vtable.ComponentId = ComponentId;
      vtable.BufferFree = global::System.Runtime.InteropServices.Marshal
          .GetFunctionPointerForDelegate(global::Improbable.Worker.Internal.ClientObjects.ClientBufferFree);
      vtable.Free = global::System.Runtime.InteropServices.Marshal
          .GetFunctionPointerForDelegate(global::Improbable.Worker.Internal.ClientObjects.ClientFree);
      vtable.Copy = global::System.Runtime.InteropServices.Marshal
          .GetFunctionPointerForDelegate(global::Improbable.Worker.Internal.ClientObjects.ClientCopy);
      vtable.Deserialize = global::System.Runtime.InteropServices.Marshal
          .GetFunctionPointerForDelegate(clientDeserialize);
      vtable.Serialize = global::System.Runtime.InteropServices.Marshal
          .GetFunctionPointerForDelegate(clientSerialize);
      return vtable;
    }
  }

  public void AddToEntityWithInitialData(global::Improbable.Worker.Internal.ComponentProtocol.ClientObject update,
                                         global::Improbable.Worker.Entity entity)
  {
    var dereferenced = (global::Improbable.Worker.IComponentUpdate<EntityAcl>)
        global::Improbable.Worker.Internal.ClientObjects.Instance
        .Dereference(update.Reference);
    entity.Add<EntityAcl>(dereferenced.ToInitialData());
  }

  public object ExtractAsUpdate(global::Improbable.Worker.Entity entity)
  {
    return entity.Get<EntityAcl>().Value.ToUpdate();
  }

  public void TrackComponent(global::Improbable.Worker.View view)
  {
    view.OnAddComponent<EntityAcl>(op =>
    {
      if (view.Entities.ContainsKey(op.EntityId))
      {
        view.Entities[op.EntityId].Add<EntityAcl>(op.Data);
      }
    });
    view.OnRemoveComponent<EntityAcl>(op =>
    {
      if (view.Entities.ContainsKey(op.EntityId))
      {
        view.Entities[op.EntityId].Remove<EntityAcl>();
      }
    });
    view.OnAuthorityChange<EntityAcl>(op =>
    {
      if (view.Entities.ContainsKey(op.EntityId))
      {
        view.Entities[op.EntityId].SetAuthority<EntityAcl>(op.HasAuthority);
      }
    });
    view.OnComponentUpdate<EntityAcl>(op =>
    {
      if (view.Entities.ContainsKey(op.EntityId))
      {
        view.Entities[op.EntityId].Update<EntityAcl>(op.Update);
      }
    });
  }

  private static unsafe readonly global::Improbable.Worker.Internal.ComponentProtocol.ClientDeserialize
      clientDeserialize = ClientDeserialize;
  private static unsafe readonly global::Improbable.Worker.Internal.ComponentProtocol.ClientSerialize
      clientSerialize = ClientSerialize;

  private static unsafe bool
  ClientDeserialize(global::System.UInt32 componentId,
                    global::System.Byte objType,
                    global::System.Byte* buffer,
                    global::System.UInt32 length,
                    global::Improbable.Worker.Internal.ComponentProtocol.ClientObject** obj)
  {
    *obj = null;
    try
    {
      *obj = global::Improbable.Worker.Internal.ClientObjects.ObjectAlloc();
      if (objType == (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Update) {
        var data = new Update();
        (*obj)->Reference = global::Improbable.Worker.Internal.ClientObjects.Instance
            .CreateReference(data);
        var stream = new global::System.IO.UnmanagedMemoryStream(buffer, (long) length);
        var protoWrapper = global::ProtoBuf.Serializer
            .Deserialize<global::Schema.Improbable.EntityComponentUpdate>(stream);
        if (protoWrapper.EntityState != null)
        {
          global::Schema.Improbable.EntityAclData _proto;
          if (global::ProtoBuf.Extensible.TryGetValue<global::Schema.Improbable.EntityAclData>(
                  protoWrapper.EntityState, (int) 50, out _proto))
          {
            if (_proto.Field1Read != null || protoWrapper.FieldsToClear.Contains(1))
            {
              global::Improbable.Collections.Option<global::Improbable.WorkerPredicate> field;
              field = new global::Improbable.Collections.Option<global::Improbable.WorkerPredicate>();
              if (_proto.Field1Read != null)
              {
                field.Set(global::Improbable.WorkerPredicate_Internal.Deserialize(_proto.Field1Read));
              }
              data.read.Set(field);
            }
            if (_proto.Field2ComponentAcl != null || protoWrapper.FieldsToClear.Contains(2))
            {
              global::Improbable.Collections.Option<global::Improbable.ComponentAcl> field;
              field = new global::Improbable.Collections.Option<global::Improbable.ComponentAcl>();
              if (_proto.Field2ComponentAcl != null)
              {
                field.Set(global::Improbable.ComponentAcl_Internal.Deserialize(_proto.Field2ComponentAcl));
              }
              data.componentAcl.Set(field);
            }
          }
        }
      }
      else if (objType == (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Snapshot)
      {
        var data = new Update();
        (*obj)->Reference = global::Improbable.Worker.Internal.ClientObjects.Instance
            .CreateReference(data);
        var stream = new global::System.IO.UnmanagedMemoryStream(buffer, (long) length);
        var protoWrapper = global::ProtoBuf.Serializer
            .Deserialize<global::Schema.Improbable.EntityState>(stream);
        var _proto = global::ProtoBuf.Extensible.GetValue<global::Schema.Improbable.EntityAclData>(
            protoWrapper, (int) 50);
        {
          global::Improbable.Collections.Option<global::Improbable.WorkerPredicate> field;
          field = new global::Improbable.Collections.Option<global::Improbable.WorkerPredicate>();
          if (_proto.Field1Read != null)
          {
            field.Set(global::Improbable.WorkerPredicate_Internal.Deserialize(_proto.Field1Read));
          }
          data.read.Set(field);
        }
        {
          global::Improbable.Collections.Option<global::Improbable.ComponentAcl> field;
          field = new global::Improbable.Collections.Option<global::Improbable.ComponentAcl>();
          if (_proto.Field2ComponentAcl != null)
          {
            field.Set(global::Improbable.ComponentAcl_Internal.Deserialize(_proto.Field2ComponentAcl));
          }
          data.componentAcl.Set(field);
        }
      }
      else if (objType == (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Request)
      {
        var data = new global::Improbable.Worker.Internal.GenericCommandObject();
        (*obj)->Reference = global::Improbable.Worker.Internal.ClientObjects.Instance
            .CreateReference(data);
      }
      else if (objType == (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Response)
      {
        var data = new global::Improbable.Worker.Internal.GenericCommandObject();
        (*obj)->Reference = global::Improbable.Worker.Internal.ClientObjects.Instance
            .CreateReference(data);
      }
    }
    catch (global::System.Exception e)
    {
      global::Improbable.Worker.ClientError.LogClientException(e);
      return false;
    }
    return true;
  }

  private static unsafe void
  ClientSerialize(global::System.UInt32 componentId,
                  global::System.Byte objType,
                  global::Improbable.Worker.Internal.ComponentProtocol.ClientObject* obj,
                  global::System.Byte** buffer,
                  global::System.UInt32* length)
  {
    *buffer = null;
    try
    {
      if (objType == (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Update) {
        var protoWrapper = new global::Schema.Improbable.EntityComponentUpdate();
        var data = (Update) global::Improbable.Worker.Internal.ClientObjects.Instance.Dereference(obj->Reference);
        {
          var _proto = new global::Schema.Improbable.EntityAclData();
          if (data.read.HasValue)
          {
            if (objType != (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Snapshot && data.read.Value.Count == 0)
            {
              protoWrapper.FieldsToClear.Add(1);
            }
            if (data.read.Value.HasValue)
            {
              _proto.Field1Read = global::Improbable.WorkerPredicate_Internal.Serialize(data.read.Value.Value);
            }
          }
          if (data.componentAcl.HasValue)
          {
            if (objType != (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Snapshot && data.componentAcl.Value.Count == 0)
            {
              protoWrapper.FieldsToClear.Add(2);
            }
            if (data.componentAcl.Value.HasValue)
            {
              _proto.Field2ComponentAcl = global::Improbable.ComponentAcl_Internal.Serialize(data.componentAcl.Value.Value);
            }
          }
          protoWrapper.EntityState = new global::Schema.Improbable.EntityState();
          global::ProtoBuf.Extensible.AppendValue(protoWrapper.EntityState, 50, _proto);
        }
        {
          var _proto = new global::Schema.Improbable.EntityAcl.Events();
          protoWrapper.EntityEvent = new global::Schema.Improbable.EntityEvent();
          global::ProtoBuf.Extensible.AppendValue(protoWrapper.EntityEvent, 50, _proto);
        }
        using (var stream = new global::Improbable.Worker.Internal.ExpandableUnmanagedMemoryStream())
        {
          global::ProtoBuf.Serializer.Serialize(stream, protoWrapper);
          *buffer = stream.TakeOwnershipOfBuffer();
          *length = (uint) stream.Length;
        }
      }
      else if (objType == (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Snapshot) {
        var protoWrapper = new global::Schema.Improbable.EntityState();
        var _proto = new global::Schema.Improbable.EntityAclData();
        var data = (Update) global::Improbable.Worker.Internal.ClientObjects.Instance.Dereference(obj->Reference);
        if (data.read.Value.HasValue)
        {
          _proto.Field1Read = global::Improbable.WorkerPredicate_Internal.Serialize(data.read.Value.Value);
        }
        if (data.componentAcl.Value.HasValue)
        {
          _proto.Field2ComponentAcl = global::Improbable.ComponentAcl_Internal.Serialize(data.componentAcl.Value.Value);
        }
        global::ProtoBuf.Extensible.AppendValue(protoWrapper, 50, _proto);
        using (var stream = new global::Improbable.Worker.Internal.ExpandableUnmanagedMemoryStream())
        {
          global::ProtoBuf.Serializer.Serialize(stream, protoWrapper);
          *buffer = stream.TakeOwnershipOfBuffer();
          *length = (uint) stream.Length;
        }
      }
      else if (objType == (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Request)
      {
        var protoWrapper = new global::Schema.Improbable.EntityCommand();
        var _proto = new global::Schema.Improbable.EntityAcl.Commands();
        global::ProtoBuf.Extensible.AppendValue(protoWrapper, 50, _proto);
        using (var stream = new global::Improbable.Worker.Internal.ExpandableUnmanagedMemoryStream())
        {
          global::ProtoBuf.Serializer.Serialize(stream, protoWrapper);
          *buffer = stream.TakeOwnershipOfBuffer();
          *length = (uint) stream.Length;
        }
      }
      else if (objType == (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Response)
      {
        var protoWrapper = new global::Schema.Improbable.EntityCommand();
        var _proto = new global::Schema.Improbable.EntityAcl.Commands();
        global::ProtoBuf.Extensible.AppendValue(protoWrapper, 50, _proto);
        using (var stream = new global::Improbable.Worker.Internal.ExpandableUnmanagedMemoryStream())
        {
          global::ProtoBuf.Serializer.Serialize(stream, protoWrapper);
          *buffer = stream.TakeOwnershipOfBuffer();
          *length = (uint) stream.Length;
        }
      }
    }
    catch (global::System.Exception e)
    {
      global::Improbable.Worker.ClientError.LogClientException(e);
    }
  }
}

}
